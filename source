// Run this in the Mongo shell (mongosh)

const collection = db.temp;

// Step 1: Fetch 100 random documents
const docs = collection.aggregate([{ $sample: { size: 100 } }]).toArray();

print(`Fetched ${docs.length} random documents.`);

// Step 2: Print _id and hon IDs
docs.forEach(d => {
  print(`_id: ${d._id}, hon: ${d.hon}`);
});

// Step 3: Create 10 copies per document with random payload.usedCount
let newDocs = [];

docs.forEach(doc => {
  for (let i = 0; i < 10; i++) {
    // Deep clone the original document
    let copy = JSON.parse(JSON.stringify(doc));
    
    // Remove _id so MongoDB assigns a new one
    delete copy._id;

    // Modify payload.usedCount with random 1â€“1000
    if (copy.payload && typeof copy.payload === "object") {
      copy.payload.usedCount = Math.floor(Math.random() * 1000) + 1;
    } else {
      copy.payload = { usedCount: Math.floor(Math.random() * 1000) + 1 };
    }

    newDocs.push(copy);
  }
});

// Step 4: Insert all new documents
if (newDocs.length > 0) {
  const result = collection.insertMany(newDocs);
  print(`Inserted ${result.insertedCount} new documents.`);
} else {
  print("No documents created for insertion.");
}
